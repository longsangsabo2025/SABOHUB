import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

/// Manager Staff Page
/// Staff management for managers
class ManagerStaffPage extends ConsumerStatefulWidget {
  const ManagerStaffPage({super.key});

  @override
  ConsumerState<ManagerStaffPage> createState() => _ManagerStaffPageState();
}

class _ManagerStaffPageState extends ConsumerState<ManagerStaffPage> {
  int _selectedTab = 0;
  String _searchQuery = '';
  String? _filterRole;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.grey.shade50,
      appBar: _buildAppBar(),
      body: Column(
        children: [
          _buildTabBar(),
          Expanded(child: _buildContent()),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () => _showAddStaffDialog(),
        backgroundColor: const Color(0xFF10B981),
        child: const Icon(Icons.add, color: Colors.white),
      ),
    );
  }

  PreferredSizeWidget _buildAppBar() {
    return AppBar(
      elevation: 0,
      backgroundColor: Colors.white,
      title: const Text(
        'Qu·∫£n l√Ω nh√¢n vi√™n',
        style: TextStyle(
          fontSize: 20,
          fontWeight: FontWeight.bold,
          color: Colors.black87,
        ),
      ),
      actions: [
        IconButton(
          onPressed: () {
            ScaffoldMessenger.of(context).showSnackBar(
              const SnackBar(
                content: Text('üîç T√¨m ki·∫øm nh√¢n vi√™n'),
                duration: Duration(seconds: 2),
                backgroundColor: Color(0xFF10B981),
              ),
            );
          },
          icon: const Icon(Icons.search, color: Colors.black54),
        ),
        IconButton(
          onPressed: () {
            showModalBottomSheet(
              context: context,
              shape: const RoundedRectangleBorder(
                borderRadius: BorderRadius.vertical(top: Radius.circular(20)),
              ),
              builder: (context) => Container(
                padding: const EdgeInsets.all(24),
                child: Column(
                  mainAxisSize: MainAxisSize.min,
                  children: [
                    ListTile(
                      leading: const Icon(Icons.sort, color: Color(0xFF10B981)),
                      title: const Text('S·∫Øp x·∫øp'),
                      onTap: () {
                        Navigator.pop(context);
                        ScaffoldMessenger.of(context).showSnackBar(
                          const SnackBar(content: Text('üîÄ ƒêang s·∫Øp x·∫øp...')),
                        );
                      },
                    ),
                    ListTile(
                      leading: const Icon(Icons.filter_list,
                          color: Color(0xFF3B82F6)),
                      title: const Text('L·ªçc'),
                      onTap: () {
                        Navigator.pop(context);
                        ScaffoldMessenger.of(context).showSnackBar(
                          const SnackBar(content: Text('üîΩ ƒêang l·ªçc...')),
                        );
                      },
                    ),
                    ListTile(
                      leading:
                          const Icon(Icons.download, color: Color(0xFFF59E0B)),
                      title: const Text('Xu·∫•t d·ªØ li·ªáu'),
                      onTap: () {
                        Navigator.pop(context);
                        ScaffoldMessenger.of(context).showSnackBar(
                          const SnackBar(content: Text('üì• ƒêang xu·∫•t...')),
                        );
                      },
                    ),
                  ],
                ),
              ),
            );
          },
          icon: const Icon(Icons.more_vert, color: Colors.black54),
        ),
      ],
    );
  }

  Widget _buildTabBar() {
    const tabs = ['ƒêi·ªÉm danh', 'L·ªãch l√†m', 'Hi·ªáu su·∫•t'];

    return Container(
      margin: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(12),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 5,
            offset: const Offset(0, 2),
          ),
        ],
      ),
      child: Row(
        children: tabs.asMap().entries.map((entry) {
          final index = entry.key;
          final tab = entry.value;
          final isSelected = index == _selectedTab;

          return Expanded(
            child: GestureDetector(
              onTap: () => setState(() => _selectedTab = index),
              child: Container(
                padding: const EdgeInsets.symmetric(vertical: 12),
                decoration: BoxDecoration(
                  color:
                      isSelected ? const Color(0xFF10B981) : Colors.transparent,
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Text(
                  tab,
                  textAlign: TextAlign.center,
                  style: TextStyle(
                    fontSize: 13,
                    fontWeight: FontWeight.w600,
                    color: isSelected ? Colors.white : Colors.grey.shade600,
                  ),
                ),
              ),
            ),
          );
        }).toList(),
      ),
    );
  }

  Widget _buildContent() {
    switch (_selectedTab) {
      case 0:
        return _buildAttendanceTab();
      case 1:
        return _buildScheduleTab();
      case 2:
        return _buildPerformanceTab();
      default:
        return _buildAttendanceTab();
    }
  }

  Widget _buildAttendanceTab() {
    final staffAsync = ref.watch(allStaffProvider(null));

    return RefreshIndicator(
      onRefresh: () async {
        ref.invalidate(allStaffProvider);
      },
      child: SingleChildScrollView(
        padding: const EdgeInsets.all(16),
        child: Column(
          children: [
            staffAsync.when(
              data: (staffList) => _buildAttendanceStats(staffList),
              loading: () => _buildLoadingStats(),
              error: (_, __) => _buildAttendanceStats([]),
            ),
            const SizedBox(height: 24),
            staffAsync.when(
              data: (staffList) => _buildAttendanceList(staffList),
              loading: () => _buildLoadingList(),
              error: (_, __) => const Center(child: Text('L·ªói t·∫£i d·ªØ li·ªáu')),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildLoadingStats() {
    return Container(
      height: 150,
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
      ),
      child: const Center(child: CircularProgressIndicator()),
    );
  }

  Widget _buildLoadingList() {
    return Container(
      height: 300,
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
      ),
      child: const Center(child: CircularProgressIndicator()),
    );
  }

  Widget _buildAttendanceStats(List<Staff> staffList) {
    final activeStaff = staffList.where((s) => s.status == 'active').length;
    final inactiveStaff = staffList.where((s) => s.status == 'inactive').length;
    final onLeave = staffList.where((s) => s.status == 'on_leave').length;
    final totalStaff = staffList.length;

    return Container(
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 10,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          const Text(
            'Th·ªëng k√™ nh√¢n vi√™n',
            style: TextStyle(
              fontSize: 16,
              fontWeight: FontWeight.bold,
            ),
          ),
          const SizedBox(height: 16),
          Row(
            children: [
              Expanded(
                child: _buildStatItem(
                    'ƒêang l√†m', '$activeStaff', const Color(0xFF10B981)),
              ),
              Expanded(
                child: _buildStatItem(
                    'Ngh·ªâ ph√©p', '$onLeave', const Color(0xFFF59E0B)),
              ),
              Expanded(
                child: _buildStatItem(
                    'Ng·ª´ng l√†m', '$inactiveStaff', const Color(0xFFEF4444)),
              ),
              Expanded(
                child: _buildStatItem(
                    'T·ªïng c·ªông', '$totalStaff', const Color(0xFF6B7280)),
              ),
            ],
          ),
        ],
      ),
    );
  }

  Widget _buildStatItem(String title, String value, Color color) {
    return Column(
      children: [
        Container(
          padding: const EdgeInsets.all(12),
          decoration: BoxDecoration(
            color: color.withValues(alpha: 0.1),
            shape: BoxShape.circle,
          ),
          child: Text(
            value,
            style: TextStyle(
              fontSize: 18,
              fontWeight: FontWeight.bold,
              color: color,
            ),
          ),
        ),
        const SizedBox(height: 8),
        Text(
          title,
          style: TextStyle(
            fontSize: 12,
            color: Colors.grey.shade600,
          ),
        ),
      ],
    );
  }

  Widget _buildAttendanceList(List<Staff> staffList) {
    return Container(
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 10,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          const Padding(
            padding: EdgeInsets.all(20),
            child: Text(
              'Danh s√°ch nh√¢n vi√™n',
              style: TextStyle(
                fontSize: 16,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
          if (staffList.isEmpty)
            const Padding(
              padding: EdgeInsets.all(40),
              child: Center(
                child: Text(
                  'Ch∆∞a c√≥ nh√¢n vi√™n',
                  style: TextStyle(color: Colors.grey),
                ),
              ),
            )
          else
            ...staffList.asMap().entries.map((entry) {
              final staff = entry.value;
              return _buildStaffItem(staff);
            }),
        ],
      ),
    );
  }

  Widget _buildStaffItem(Staff staff) {
    Color statusColor = Colors.green;
    IconData statusIcon = Icons.check_circle;
    
    if (staff.status == 'on_leave') {
      statusColor = Colors.orange;
      statusIcon = Icons.event_busy;
    } else if (staff.status == 'inactive') {
      statusColor = Colors.red;
      statusIcon = Icons.cancel;
    }

    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 16),
      decoration: BoxDecoration(
        border: Border(
          bottom: BorderSide(color: Colors.grey.shade200),
        ),
      ),
      child: Row(
        children: [
          CircleAvatar(
            radius: 24,
            backgroundColor: statusColor.withValues(alpha: 0.1),
            child: Text(
              staff.name.isNotEmpty ? staff.name[0].toUpperCase() : '?',
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
                color: statusColor,
              ),
            ),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  staff.name,
                  style: const TextStyle(
                    fontSize: 15,
                    fontWeight: FontWeight.w600,
                  ),
                ),
                const SizedBox(height: 4),
                Text(
                  staff.roleDisplayName,
                  style: TextStyle(
                    fontSize: 13,
                    color: Colors.grey.shade600,
                  ),
                ),
              ],
            ),
          ),
          Container(
            padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
            decoration: BoxDecoration(
              color: statusColor.withValues(alpha: 0.1),
              borderRadius: BorderRadius.circular(20),
            ),
            child: Row(
              mainAxisSize: MainAxisSize.min,
              children: [
                Icon(statusIcon, size: 14, color: statusColor),
                const SizedBox(width: 4),
                Text(
                  staff.statusDisplayName,
                  style: TextStyle(
                    fontSize: 12,
                    fontWeight: FontWeight.w600,
                    color: statusColor,
                  ),
                ),
              ],
            ),
          ),
          IconButton(
            onPressed: () => _showStaffActions(staff),
            icon: const Icon(Icons.more_vert, size: 20),
            color: Colors.grey.shade600,
          ),
        ],
      ),
    );
  }

  void _showStaffActions(Staff staff) {
    showModalBottomSheet(
      context: context,
      shape: const RoundedRectangleBorder(
        borderRadius: BorderRadius.vertical(top: Radius.circular(20)),
      ),
      builder: (context) => Container(
        padding: const EdgeInsets.all(24),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            Text(
              staff.name,
              style: const TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            const SizedBox(height: 20),
            ListTile(
              leading: const Icon(Icons.edit, color: Color(0xFF3B82F6)),
              title: const Text('Ch·ªânh s·ª≠a'),
              onTap: () {
                Navigator.pop(context);
                _showEditStaffDialog(staff);
              },
            ),
            ListTile(
              leading: const Icon(Icons.swap_horiz, color: Color(0xFFF59E0B)),
              title: const Text('Thay ƒë·ªïi tr·∫°ng th√°i'),
              onTap: () {
                Navigator.pop(context);
                _showChangeStatusDialog(staff);
              },
            ),
            ListTile(
              leading: const Icon(Icons.delete, color: Color(0xFFEF4444)),
              title: const Text('X√≥a nh√¢n vi√™n'),
              onTap: () {
                Navigator.pop(context);
                _showDeleteConfirmDialog(staff);
              },
            ),
          ],
        ),
      ),
    );
  }

  void _showAddStaffDialog() {
    final nameController = TextEditingController();
    final emailController = TextEditingController();
    final phoneController = TextEditingController();
    String selectedRole = 'staff';

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Th√™m nh√¢n vi√™n m·ªõi'),
        content: SingleChildScrollView(
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              TextField(
                controller: nameController,
                decoration: const InputDecoration(
                  labelText: 'H·ªç v√† t√™n',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 12),
              TextField(
                controller: emailController,
                decoration: const InputDecoration(
                  labelText: 'Email',
                  border: OutlineInputBorder(),
                ),
                keyboardType: TextInputType.emailAddress,
              ),
              const SizedBox(height: 12),
              TextField(
                controller: phoneController,
                decoration: const InputDecoration(
                  labelText: 'S·ªë ƒëi·ªán tho·∫°i',
                  border: OutlineInputBorder(),
                ),
                keyboardType: TextInputType.phone,
              ),
              const SizedBox(height: 12),
              DropdownButtonFormField<String>(
                value: selectedRole,
                decoration: const InputDecoration(
                  labelText: 'Vai tr√≤',
                  border: OutlineInputBorder(),
                ),
                items: const [
                  DropdownMenuItem(value: 'staff', child: Text('Nh√¢n vi√™n')),
                  DropdownMenuItem(value: 'shift_leader', child: Text('Tr∆∞·ªüng ca')),
                ],
                onChanged: (value) {
                  if (value != null) selectedRole = value;
                },
              ),
            ],
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('H·ªßy'),
          ),
          ElevatedButton(
            onPressed: () async {
              if (nameController.text.isEmpty || emailController.text.isEmpty) {
                ScaffoldMessenger.of(context).showSnackBar(
                  const SnackBar(content: Text('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin')),
                );
                return;
              }

              try {
                final service = ref.read(staffServiceProvider);
                await service.createStaff(
                  name: nameController.text,
                  email: emailController.text,
                  role: selectedRole,
                  phone: phoneController.text.isEmpty ? null : phoneController.text,
                );

                if (mounted) {
                  Navigator.pop(context);
                  ref.invalidate(allStaffProvider);
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(
                      content: Text('‚úÖ Th√™m nh√¢n vi√™n th√†nh c√¥ng'),
                      backgroundColor: Color(0xFF10B981),
                    ),
                  );
                }
              } catch (e) {
                if (mounted) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('‚ùå L·ªói: $e')),
                  );
                }
              }
            },
            style: ElevatedButton.styleFrom(
              backgroundColor: const Color(0xFF10B981),
            ),
            child: const Text('Th√™m', style: TextStyle(color: Colors.white)),
          ),
        ],
      ),
    );
  }

  void _showEditStaffDialog(Staff staff) {
    final nameController = TextEditingController(text: staff.name);
    final emailController = TextEditingController(text: staff.email);
    final phoneController = TextEditingController(text: staff.phone ?? '');
    String selectedRole = staff.role;

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Ch·ªânh s·ª≠a nh√¢n vi√™n'),
        content: SingleChildScrollView(
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              TextField(
                controller: nameController,
                decoration: const InputDecoration(
                  labelText: 'H·ªç v√† t√™n',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 12),
              TextField(
                controller: emailController,
                decoration: const InputDecoration(
                  labelText: 'Email',
                  border: OutlineInputBorder(),
                ),
                keyboardType: TextInputType.emailAddress,
              ),
              const SizedBox(height: 12),
              TextField(
                controller: phoneController,
                decoration: const InputDecoration(
                  labelText: 'S·ªë ƒëi·ªán tho·∫°i',
                  border: OutlineInputBorder(),
                ),
                keyboardType: TextInputType.phone,
              ),
              const SizedBox(height: 12),
              DropdownButtonFormField<String>(
                value: selectedRole,
                decoration: const InputDecoration(
                  labelText: 'Vai tr√≤',
                  border: OutlineInputBorder(),
                ),
                items: const [
                  DropdownMenuItem(value: 'staff', child: Text('Nh√¢n vi√™n')),
                  DropdownMenuItem(value: 'shift_leader', child: Text('Tr∆∞·ªüng ca')),
                ],
                onChanged: (value) {
                  if (value != null) selectedRole = value;
                },
              ),
            ],
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('H·ªßy'),
          ),
          ElevatedButton(
            onPressed: () async {
              try {
                final service = ref.read(staffServiceProvider);
                await service.updateStaff(staff.id, {
                  'name': nameController.text,
                  'full_name': nameController.text,
                  'email': emailController.text,
                  'phone': phoneController.text.isEmpty ? null : phoneController.text,
                  'role': selectedRole,
                });

                if (mounted) {
                  Navigator.pop(context);
                  ref.invalidate(allStaffProvider);
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(
                      content: Text('‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng'),
                      backgroundColor: Color(0xFF10B981),
                    ),
                  );
                }
              } catch (e) {
                if (mounted) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('‚ùå L·ªói: $e')),
                  );
                }
              }
            },
            style: ElevatedButton.styleFrom(
              backgroundColor: const Color(0xFF3B82F6),
            ),
            child: const Text('L∆∞u', style: TextStyle(color: Colors.white)),
          ),
        ],
      ),
    );
  }

  void _showChangeStatusDialog(Staff staff) {
    String selectedStatus = staff.status;

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Thay ƒë·ªïi tr·∫°ng th√°i'),
        content: DropdownButtonFormField<String>(
          value: selectedStatus,
          decoration: const InputDecoration(
            labelText: 'Tr·∫°ng th√°i',
            border: OutlineInputBorder(),
          ),
          items: const [
            DropdownMenuItem(value: 'active', child: Text('ƒêang l√†m vi·ªác')),
            DropdownMenuItem(value: 'on_leave', child: Text('Ngh·ªâ ph√©p')),
            DropdownMenuItem(value: 'inactive', child: Text('Ng·ª´ng l√†m')),
          ],
          onChanged: (value) {
            if (value != null) selectedStatus = value;
          },
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('H·ªßy'),
          ),
          ElevatedButton(
            onPressed: () async {
              try {
                final service = ref.read(staffServiceProvider);
                await service.updateStaff(staff.id, {'status': selectedStatus});

                if (mounted) {
                  Navigator.pop(context);
                  ref.invalidate(allStaffProvider);
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(
                      content: Text('‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng'),
                      backgroundColor: Color(0xFF10B981),
                    ),
                  );
                }
              } catch (e) {
                if (mounted) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('‚ùå L·ªói: $e')),
                  );
                }
              }
            },
            style: ElevatedButton.styleFrom(
              backgroundColor: const Color(0xFFF59E0B),
            ),
            child: const Text('L∆∞u', style: TextStyle(color: Colors.white)),
          ),
        ],
      ),
    );
  }

  void _showDeleteConfirmDialog(Staff staff) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('X√°c nh·∫≠n x√≥a'),
        content: Text('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n "${staff.name}"?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('H·ªßy'),
          ),
          ElevatedButton(
            onPressed: () async {
              try {
                final service = ref.read(staffServiceProvider);
                await service.deleteStaff(staff.id);

                if (mounted) {
                  Navigator.pop(context);
                  ref.invalidate(allStaffProvider);
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(
                      content: Text('‚úÖ X√≥a nh√¢n vi√™n th√†nh c√¥ng'),
                      backgroundColor: Color(0xFF10B981),
                    ),
                  );
                }
              } catch (e) {
                if (mounted) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('‚ùå L·ªói: $e')),
                  );
                }
              }
            },
            style: ElevatedButton.styleFrom(
              backgroundColor: const Color(0xFFEF4444),
            ),
            child: const Text('X√≥a', style: TextStyle(color: Colors.white)),
          ),
        ],
      ),
    );
  }
              'Ho√†ng VƒÉn E',
              'V≈© Th·ªã F',
              'ƒê·∫∑ng VƒÉn G',
              'B√πi Th·ªã H'
            ];
            final statuses = [
              'C√≥ m·∫∑t',
              'C√≥ m·∫∑t',
              'Mu·ªôn',
              'V·∫Øng m·∫∑t',
              'C√≥ m·∫∑t',
              'C√≥ m·∫∑t',
              'C√≥ m·∫∑t',
              'C√≥ m·∫∑t'
            ];
            final times = [
              '08:00',
              '08:15',
              '08:35',
              '---',
              '07:55',
              '08:10',
              '08:05',
              '07:50'
            ];
            final colors = [
              Colors.green,
              Colors.green,
              Colors.orange,
              Colors.red,
              Colors.green,
              Colors.green,
              Colors.green,
              Colors.green
            ];

            return _buildAttendanceItem(
              names[index],
              statuses[index],
              times[index],
              colors[index],
              index == 7, // isLast
            );
          }),
        ],
      ),
    );
  }

  Widget _buildAttendanceItem(
      String name, String status, String time, Color statusColor, bool isLast) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 16),
      decoration: BoxDecoration(
        border: isLast
            ? null
            : Border(
                bottom: BorderSide(color: Colors.grey.shade200),
              ),
      ),
      child: Row(
        children: [
          CircleAvatar(
            radius: 20,
            backgroundColor: Colors.grey.shade200,
            child: Text(
              name[0],
              style: const TextStyle(
                fontWeight: FontWeight.bold,
                color: Colors.black87,
              ),
            ),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  name,
                  style: const TextStyle(
                    fontSize: 14,
                    fontWeight: FontWeight.w600,
                  ),
                ),
                Text(
                  'Check-in: $time',
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey.shade600,
                  ),
                ),
              ],
            ),
          ),
          Container(
            padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
            decoration: BoxDecoration(
              color: statusColor.withValues(alpha: 0.1),
              borderRadius: BorderRadius.circular(8),
            ),
            child: Text(
              status,
              style: TextStyle(
                fontSize: 11,
                fontWeight: FontWeight.w500,
                color: statusColor,
              ),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildScheduleTab() {
    return SingleChildScrollView(
      padding: const EdgeInsets.all(16),
      child: Column(
        children: [
          _buildScheduleHeader(),
          const SizedBox(height: 24),
          _buildWeeklySchedule(),
        ],
      ),
    );
  }

  Widget _buildScheduleHeader() {
    return Container(
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 10,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Row(
        children: [
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                const Text(
                  'L·ªãch l√†m vi·ªác tu·∫ßn n√†y',
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.bold,
                  ),
                ),
                const SizedBox(height: 8),
                Text(
                  '1 - 7 Th√°ng 11, 2025',
                  style: TextStyle(
                    fontSize: 14,
                    color: Colors.grey.shade600,
                  ),
                ),
              ],
            ),
          ),
          Row(
            children: [
              IconButton(
                onPressed: () {
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(
                      content: Text('‚óÄÔ∏è Tu·∫ßn tr∆∞·ªõc'),
                      duration: Duration(seconds: 2),
                    ),
                  );
                },
                icon: const Icon(Icons.chevron_left),
              ),
              IconButton(
                onPressed: () {
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(
                      content: Text('‚ñ∂Ô∏è Tu·∫ßn sau'),
                      duration: Duration(seconds: 2),
                    ),
                  );
                },
                icon: const Icon(Icons.chevron_right),
              ),
            ],
          ),
        ],
      ),
    );
  }

  Widget _buildWeeklySchedule() {
    const days = ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'];
    const dates = ['1', '2', '3', '4', '5', '6', '7'];

    return Container(
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 10,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        children: [
          // Days header
          Container(
            padding: const EdgeInsets.symmetric(vertical: 16),
            decoration: BoxDecoration(
              color: Colors.grey.shade50,
              borderRadius: const BorderRadius.only(
                topLeft: Radius.circular(16),
                topRight: Radius.circular(16),
              ),
            ),
            child: Row(
              children: days.asMap().entries.map((entry) {
                final day = entry.value;
                final date = dates[entry.key];
                return Expanded(
                  child: Column(
                    children: [
                      Text(
                        day,
                        style: TextStyle(
                          fontSize: 12,
                          fontWeight: FontWeight.w500,
                          color: Colors.grey.shade600,
                        ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        date,
                        style: const TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                    ],
                  ),
                );
              }).toList(),
            ),
          ),
          // Schedule content
          ...List.generate(4, (staffIndex) {
            final staffNames = [
              'Nguy·ªÖn VƒÉn A',
              'Tr·∫ßn Th·ªã B',
              'L√™ VƒÉn C',
              'Ph·∫°m Th·ªã D'
            ];
            return _buildStaffScheduleRow(
                staffNames[staffIndex], staffIndex == 3);
          }),
        ],
      ),
    );
  }

  Widget _buildStaffScheduleRow(String staffName, bool isLast) {
    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        border: isLast
            ? null
            : Border(
                bottom: BorderSide(color: Colors.grey.shade200),
              ),
      ),
      child: Row(
        children: [
          SizedBox(
            width: 80,
            child: Text(
              staffName,
              style: const TextStyle(
                fontSize: 12,
                fontWeight: FontWeight.w500,
              ),
            ),
          ),
          Expanded(
            child: Row(
              children: List.generate(7, (dayIndex) {
                final shifts = [
                  'S',
                  'C',
                  'T',
                  'S',
                  'C',
                  'OFF',
                  'OFF'
                ]; // S=S√°ng, C=Chi·ªÅu, T=T·ªëi, OFF=Ngh·ªâ
                final colors = [
                  const Color(0xFF10B981),
                  const Color(0xFF3B82F6),
                  const Color(0xFF8B5CF6),
                  const Color(0xFF10B981),
                  const Color(0xFF3B82F6),
                  Colors.grey,
                  Colors.grey
                ];

                return Expanded(
                  child: Container(
                    margin: const EdgeInsets.symmetric(horizontal: 2),
                    padding: const EdgeInsets.symmetric(vertical: 8),
                    decoration: BoxDecoration(
                      color: colors[dayIndex].withValues(alpha: 0.1),
                      borderRadius: BorderRadius.circular(6),
                    ),
                    child: Text(
                      shifts[dayIndex],
                      textAlign: TextAlign.center,
                      style: TextStyle(
                        fontSize: 12,
                        fontWeight: FontWeight.w600,
                        color: colors[dayIndex],
                      ),
                    ),
                  ),
                );
              }),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildPerformanceTab() {
    return SingleChildScrollView(
      padding: const EdgeInsets.all(16),
      child: Column(
        children: [
          _buildPerformanceOverview(),
          const SizedBox(height: 24),
          _buildPerformanceList(),
        ],
      ),
    );
  }

  Widget _buildPerformanceOverview() {
    return Container(
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 10,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          const Text(
            'T·ªïng quan hi·ªáu su·∫•t',
            style: TextStyle(
              fontSize: 16,
              fontWeight: FontWeight.bold,
            ),
          ),
          const SizedBox(height: 16),
          Row(
            children: [
              Expanded(
                child: _buildPerformanceMetric(
                    'Hi·ªáu su·∫•t TB', '87%', const Color(0xFF10B981)),
              ),
              Expanded(
                child: _buildPerformanceMetric(
                    'ƒê√°nh gi√° cao', '12/15', const Color(0xFF3B82F6)),
              ),
              Expanded(
                child: _buildPerformanceMetric(
                    'C·∫ßn c·∫£i thi·ªán', '3/15', const Color(0xFFF59E0B)),
              ),
            ],
          ),
        ],
      ),
    );
  }

  Widget _buildPerformanceMetric(String title, String value, Color color) {
    return Column(
      children: [
        Text(
          value,
          style: TextStyle(
            fontSize: 20,
            fontWeight: FontWeight.bold,
            color: color,
          ),
        ),
        const SizedBox(height: 4),
        Text(
          title,
          textAlign: TextAlign.center,
          style: TextStyle(
            fontSize: 12,
            color: Colors.grey.shade600,
          ),
        ),
      ],
    );
  }

  Widget _buildPerformanceList() {
    return Container(
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.05),
            blurRadius: 10,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          const Padding(
            padding: EdgeInsets.all(20),
            child: Text(
              'Hi·ªáu su·∫•t nh√¢n vi√™n',
              style: TextStyle(
                fontSize: 16,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
          ...List.generate(6, (index) {
            final names = [
              'Nguy·ªÖn VƒÉn A',
              'Tr·∫ßn Th·ªã B',
              'L√™ VƒÉn C',
              'Ph·∫°m Th·ªã D',
              'Ho√†ng VƒÉn E',
              'V≈© Th·ªã F'
            ];
            final scores = [95, 88, 92, 76, 84, 91];
            final ratings = [
              'Xu·∫•t s·∫Øc',
              'T·ªët',
              'T·ªët',
              'Trung b√¨nh',
              'T·ªët',
              'T·ªët'
            ];
            final colors = [
              const Color(0xFF10B981),
              const Color(0xFF10B981),
              const Color(0xFF10B981),
              const Color(0xFFF59E0B),
              const Color(0xFF10B981),
              const Color(0xFF10B981)
            ];

            return _buildPerformanceItem(
              names[index],
              scores[index],
              ratings[index],
              colors[index],
              index == 5, // isLast
            );
          }),
        ],
      ),
    );
  }

  Widget _buildPerformanceItem(
      String name, int score, String rating, Color color, bool isLast) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 16),
      decoration: BoxDecoration(
        border: isLast
            ? null
            : Border(
                bottom: BorderSide(color: Colors.grey.shade200),
              ),
      ),
      child: Row(
        children: [
          CircleAvatar(
            radius: 20,
            backgroundColor: Colors.grey.shade200,
            child: Text(
              name[0],
              style: const TextStyle(
                fontWeight: FontWeight.bold,
                color: Colors.black87,
              ),
            ),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  name,
                  style: const TextStyle(
                    fontSize: 14,
                    fontWeight: FontWeight.w600,
                  ),
                ),
                Text(
                  'ƒêi·ªÉm: $score/100',
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey.shade600,
                  ),
                ),
              ],
            ),
          ),
          Container(
            padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
            decoration: BoxDecoration(
              color: color.withValues(alpha: 0.1),
              borderRadius: BorderRadius.circular(8),
            ),
            child: Text(
              rating,
              style: TextStyle(
                fontSize: 11,
                fontWeight: FontWeight.w500,
                color: color,
              ),
            ),
          ),
        ],
      ),
    );
  }
}
